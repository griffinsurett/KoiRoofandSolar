---
// src/components/Footer.astro
import { buildMenuQueries } from "@/utils/ArrayQueryUtils";
import Menu from "./Menu/BarMenu/NavMenu.astro";
import { Image } from "astro:assets";
import { SiteData, ContactData } from "@/content/SiteData";
import BackgroundContainer from "./BackgroundContainer.astro";
import KoiVideoPoster from "@/assets/videothumbnail.jpeg";
import KoiVideo from "@/assets/video.mp4";
import Heading from "./Heading";
import { MainNavMenu } from "@/queries/MainNavMenu";
import { getCollection } from "astro:content";

// Only the redundant classes:
const menuListClass =
  "flex flex-col justify-center items-center xl:items-start gap-[var(--spacing-xs)] py-[var(--spacing-xs)]";
const menuItemClass = "hover:text-accent text-lg uppercase";
const contactItemClass =
  "flex flex-col justify-center xl:justify-start gap-[var(--spacing-xs)] pt-[var(--spacing-sm)] text-lg";
const linkHoverClass = "text-bg hover:text-accent";
const bottomLinksHoverClass =
  "text-accent hover:text-secondary hover:underline";
const menuHeadingClass = "h4 font-medium pr-[var(--spacing-sm)]";

const FooterMenu = [
  {
    id: "privacy",
    label: "Privacy Policy",
    slug: "/privacy-policy",
    weight: 10,
  },
  { id: "cookie", label: "Cookie Policy", slug: "/cookie-policy", weight: 20 },
  { id: "contact", label: "Contact Us", slug: "/contact-us", weight: 30 },
];

// Pull in services collection and map to menu items
const servicesEntries = await getCollection("services");
const servicesMenuItems = servicesEntries.map(entry => ({
  id: entry.id,
  label: entry.data.title,
  slug: `/${entry.slug}`,
}));
---
<footer class="text-bg">
  <div
    class="footer-top flex justify-center items-center text-center xl:text-left"
  >
    <BackgroundContainer
      class="bg-cover bg-center bg-fixed flex justify-center items-center py-[var(--spacing-lg)]"
      contentClass="flex justify-center items-center"
      backgroundMedia={{
        video: {
          src: KoiVideo,
          poster: SiteData.MainBGImage.src,
          class: "rounded-2xl shadow-lg",
        },
        image: {
          src: SiteData.MainBGImage.src,
          imageClass: "bg-cover filter brightness-50 bg-center xl:bg-fixed",
        },
        overlayClass: "bg-primary opacity-60",
      }}
    >
      <div
        class="top-footer-wrap flex items-center justify-between py-[var(--spacing-lg)] xl:px-[var(--spacing-lg)] flex-col xl:flex-row w-9/10"
      >
        <!-- Logo & Description -->
        <div
          class="w-full text-center xl:text-left lg:w-3/4 xl:w-1/4 flex flex-col xl:items-start justify-center items-center mb-[var(--spacing-lg)] lg:mt-0"
        >
          <a href="/">
            <Image
              src={SiteData.logo.src}
              alt={`${SiteData.title} logo`}
              class="h-28 w-auto"
            />
          </a>
          <p class="text-lg font-thin text-text-light pt-[var(--spacing-md)]">
            {SiteData.description}
          </p>
        </div>

        <!-- Menus -->
        <div class="w-full flex justify-center xl:justify-end">
          <div
            class="w-9/10 flex flex-col lg:flex-row justify-between gap-[var(--spacing-xl)]"
          >
            <!-- Quick Links -->
            <div class="w-full lg:w-1/5">
              <Heading tagName="h4" className={menuHeadingClass}
                >Quick Links:</Heading
              >
              <Menu
                listClass={menuListClass}
                items={await buildMenuQueries({ MainNavMenu })}
                menuItem={{ class: menuItemClass }}
              />
            </div>

            <!-- Info & Services Sections -->
            <div class="w-full lg:w-1/5 space-y-[var(--spacing-md)]">
                <!-- Services -->
                <div class="flex-col">
                  <Heading tagName="h4" className={menuHeadingClass}
                    >Services:</Heading
                  >
                  <Menu
                    listClass={menuListClass}
                    items={servicesMenuItems}
                    menuItem={{ class: menuItemClass }}
                  />
                </div>
              <!-- Info -->
              <div class="flex-col">
                <Heading tagName="h4" className={menuHeadingClass}
                  >Info:</Heading
                >
                <Menu
                  listClass={menuListClass}
                  items={await buildMenuQueries({ FooterMenu })}
                  menuItem={{ class: menuItemClass }}
                />
              </div>
            
            </div>

            <!-- Contact Us -->
            <div
              class="w-full lg:w-2/5 justify-center items-center xl:items-start text-center xl:text-left"
            >
              <div class={contactItemClass}>
                <Heading tagName="label" class="h6 font-medium"
                  >Business Hours:</Heading
                >
                {ContactData.businessHours.days}:
                {ContactData.businessHours.hours}
              </div>
              <div class={contactItemClass}>
                <Heading tagName="label" class="h6 font-medium"
                  >Email Us:</Heading
                >
                <a href={`mailto:${ContactData.email}`} class={linkHoverClass}
                  >{ContactData.email}</a
                >
              </div>
              <div class={contactItemClass}>
                <Heading tagName="label" class="h6 font-medium"
                  >Call Us:</Heading
                >
                <a href={`tel:${ContactData.phone}`} class={linkHoverClass}
                  >{ContactData.phone}</a
                >
              </div>
            </div>
          </div>
        </div>
      </div>
    </BackgroundContainer>
  </div>

  <!-- Footer Bottom -->
  <div
    class="footer-bottom flex justify-center items-center p-[var(--spacing-md)]"
  >
    <p class="font-thin m-0 p-0 text-lg text-center">
      &copy; {new Date().getFullYear()} {SiteData.title} All rights reserved. | Website by
      <a
        href="https://griffinswebservices.com"
        target="_blank"
        rel="noopener noreferrer"
        class={bottomLinksHoverClass}
      >
        Griffin's Web Services
      </a>
      | Marketing by Koi Crest Marketing
    </p>
  </div>
</footer>
